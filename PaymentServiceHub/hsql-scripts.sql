DROP TABLE IF EXISTS CUST_PYMT_TOKEN;

DROP TABLE IF EXISTS CARD_TOKEN_VAULT;

DROP TABLE IF EXISTS CUST_CARD;

DROP TABLE IF EXISTS CUST_URN_TOKEN;

DROP TABLE IF EXISTS oauth_client_details;

DROP TABLE IF EXISTS CUST;
                                         
CREATE TABLE CUST_PYMT_TOKEN (
	ID INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) NOT NULL,
	TOKEN BIGINT DEFAULT 0 NOT NULL,
	EXP_DATE DATE NOT NULL,
	CARD_ID INT DEFAULT 0 NOT NULL,
	PAN_LAST4_DIGIT INT DEFAULT 0 NOT NULL,
    EXPIRED varchar (1) DEFAULT 'N',
	PRIMARY KEY (ID)
);

CREATE TABLE CUST (
	ID INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) NOT NULL,
	FIRST_NAME varchar(30) NOT NULL,
	LAST_NAME varchar(30) NOT NULL,
	TITLE varchar(15),
	LOGIN_ID varchar(12),
	PASSWORD varchar(12),
	PRIMARY KEY (ID)
);

INSERT INTO CUST (FIRST_NAME, LAST_NAME, LOGIN_ID, PASSWORD) values ('John', 'Doe', 'user', 'password' );

create table CARD_TOKEN_VAULT (
	ID INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) NOT NULL,
	PAN BIGINT DEFAULT 0 NOT NULL,
	PAN_EXP_DATE varchar(40) DEFAULT NULL,
	PAN_LAST4_DIGIT INT DEFAULT 0 NOT NULL,
	TOKEN BIGINT DEFAULT 0 NOT NULL,
	TOKEN_EXP_DATE varchar(40) DEFAULT NULL,
	PRIMARY KEY (ID)
);


CREATE TABLE CUST_CARD (
	ID INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) NOT NULL,
	PAN_NUM BIGINT DEFAULT 0 NOT NULL,
	EXP_DATE DATE NOT NULL,
	CUST_ID INT DEFAULT 0 NOT NULL,
	PRIMARY KEY (ID)
);

INSERT INTO CUST_CARD (PAN_NUM, EXP_DATE, CUST_ID) values ('4235987623451982', DATE '2020-12-01', (select id from cust where login_id = 'user' ));
INSERT INTO CUST_CARD (PAN_NUM, EXP_DATE, CUST_ID) values ('7265987623451989', DATE '2020-12-01', (select id from cust where login_id = 'user' ));
INSERT INTO CUST_CARD (PAN_NUM, EXP_DATE, CUST_ID) values ('5265587623451985', DATE '2020-12-01', (select id from cust where login_id = 'user' ));


CREATE TABLE CUST_URN_TOKEN (
	ID INT GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) NOT NULL,
	URN VARCHAR(8) DEFAULT '00000000' NOT NULL,
	EXP_DATE DATE NOT NULL,
	MONETARY_VALUE FLOAT DEFAULT 0 NOT NULL,
	TOKEN_ID INT DEFAULT 0 NOT NULL,
	EXPIRED varchar (1) DEFAULT 'N',
	PRIMARY KEY (ID)
);

CREATE TABLE oauth_client_details (
	  client_id varchar(40) NOT NULL,
	  client_name varchar(256) default NULL,
	  client_domain varchar(256) default NULL,
	  resource_ids varchar(256) DEFAULT NULL,
	  client_secret varchar(256) DEFAULT NULL,
	  scope varchar(256) DEFAULT NULL,
	  authorized_grant_types varchar(256) DEFAULT NULL,
	  web_server_redirect_uri varchar(256) DEFAULT NULL,
	  authorities varchar(256) DEFAULT NULL,
	  access_token_validity int DEFAULT NULL,
	  refresh_token_validity int DEFAULT NULL,
	  additional_information varchar(256) DEFAULT NULL,
	  autoapprove varchar(256) DEFAULT NULL,
	  PRIMARY KEY (client_id)
);

SELECT * FROM CUST_URN_TOKEN URN, CUST_PYMT_TOKEN TOKEN WHERE URN.URN = '32491989' AND URN.TOKEN_ID = TOKEN.ID
/*
UPDATE CUST_URN_TOKEN SET EXPIRED = 'Y' WHERE TOKEN_ID = (SELECT ID FROM CUST_PYMT_TOKEN WHERE TOKEN = '3492278801075174')
insert into cust_urn_token (URN,EXP_DATE,MONETARY_VALUE, TOKEN_ID ) values ('jdfh2765', '2021-08-01', 250, 1);
select * from CUST_PYMT_TOKEN
select * from  CUST_urn_token
select * from CARD_TOKEN_VAULT
insert into  CUST_PYMT_TOKEN (TOKEN, EXP_DATE, CARD_ID, PAN_LAST4_DIGIT) values ( '485247275522337', DATE '2021-08-01', 1 , 4567)
insert into  CUST_URN_TOKEN (TOKEN, EXP_DATE, CARD_ID, PAN_LAST4_DIGIT) values ( '485247275522337', DATE '2021-08-01', 1 , 4567)
UPDATE CUST_URN_TOKEN SET EXPIRED = 'Y' WHERE TOKEN_ID = (SELECT TOKEN_ID FROM CUST_PYMT_TOKEN WHERE TOKEN = '485247275522337') ;
UPDATE CUST_PYMT_TOKEN SET EXPIRED = 'Y' WHERE TOKEN = '485247275522337'*/